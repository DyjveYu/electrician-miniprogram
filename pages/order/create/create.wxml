<view class="page-container">
  <!-- 服务类型 -->
  <view class="form-section">
    <view class="section-title">选择服务类型</view>
    <view class="service-list">
      <block wx:for="{{serviceTypes}}" wx:key="id">
        <view class="service-item {{selectedServiceType && selectedServiceType.id === item.id ? 'active' : ''}}" 
              data-index="{{index}}" 
              bindtap="selectServiceType">
          <text>{{item.name}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 问题描述 -->
  <view class="form-section">
    <view class="section-title">{{descriptionTitle}}</view>
    <textarea placeholder="请填写服务内容..." 
              value="{{description}}" 
              bindinput="onDescriptionInput" 
              maxlength="150"
              class="desc-textarea"/>
  </view>

  <!-- 上传图片 -->
  <view class="form-section">
    <view class="section-title">上传图片（非必填）</view>
    <view class="image-list">
      <block wx:for="{{images}}" wx:key="index">
        <image src="{{item}}" class="uploaded-image" mode="aspectFill" />
      </block>
      <view class="add-image" bindtap="chooseImage" wx:if="{{images.length < 5}}">+</view>
    </view>
  </view>

  <!-- 服务地址 -->
  <view class="form-section">
  <view class="section-title">服务地址</view>
    <view class="form-item" bindtap="openAddressSheet">
     
      <view class="value">
        <text wx:if="{{selectedAddressStr}}">{{selectedAddressStr}}</text>
        <text wx:else class="placeholder">点击选择地址</text>
      </view>
    </view>
  </view>
  <!-- 复选框 -->
    <view class="form-section">
    <view class="terms-row">
      <checkbox-group bindchange="onAgreeChange">
        <label class="terms-label">
          <checkbox value="agree" checked="{{agreePrepayTerms}}"></checkbox>
          <text class="terms-text">下单预约将支付维修预付款。如因您个人原因（如取消服务、无法提供维修条件等）导致未能完成维修，该预付款将作为上门服务费不予退还。</text>
        </label>
      </checkbox-group>
    </view>
  </view>

  <!-- 底部提交预约条 -->
  <view class="submit-bar">
    <view class="prepay-text">预付 ￥{{prepayAmount}}</view>
    <button class="booking-btn" bindtap="submitOrder" loading="{{submitting}}" disabled="{{!canSubmit}}">
      {{submitting ? '正在创建订单' : '立即下单预约'}}
    </button>
  </view>

  <!-- 地址选择弹层 -->
  <view wx:if="{{showAddressSheet}}" class="sheet-mask" bindtap="closeAddressSheet"></view>
  <view wx:if="{{showAddressSheet}}" class="action-sheet" catchtouchmove="true">
    <view class="sheet-header">
      <text>选择服务地址</text>
      <view class="close-icon" bindtap="closeAddressSheet">×</view>
    </view>
    <scroll-view scroll-y="true" class="sheet-body">
      <view class="address-item" wx:for="{{addresses}}" wx:key="id" bindtap="selectAddress" data-address="{{item}}">
        <view class="address-main">
          <text class="addr-title">{{item.contactName}} {{item.contactPhone}}</text>
          <view class="addr-detail">{{item.province}}{{item.city}}{{item.district}}{{item.detail}}</view>
        </view>
        <view class="addr-actions">
          <button class="mini-btn" data-id="{{item.id}}" bindtap="editAddress" catchtap="editAddress">编辑</button>
        </view>
      </view>
      <view class="empty-tip" wx:if="{{!loadingAddresses && addresses.length === 0}}">暂无地址，请新增</view>
    </scroll-view>
    <view class="sheet-footer">
      <button class="footer-btn primary" bindtap="addAddress">服务地址</button>
    </view>
  </view>

</view>
